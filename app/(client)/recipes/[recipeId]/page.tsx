import { RecipeType } from '@/app/types/interface';
import { CookingPot, List, NotepadText, Wheat } from 'lucide-react';
import { GetServerSidePropsContext, Metadata } from 'next';
import dynamic from 'next/dynamic';
import Image from 'next/image';
import { useParams } from 'next/navigation';
import React from 'react'
import Slider from '@/components/swiper/slider';
import Tabs from './_component/Tabs';

async function getRecipe(context: GetServerSidePropsContext) {
    'use server';
    try {
        const { recipeId } = context.params!;

        if (recipeId === undefined) return null;

        const response = await fetch(`http://localhost:3000/api/recipe/${recipeId}`, { method: 'GET' });
        const data = await response.json();

        if (!data.success) {
            throw new Error(data.message);
        }

        return data.data;
    } catch (error) {
        throw new Error(`Failed to fetch recipe: ${error}`);
    }
}

export const metadata: Metadata = {
    title: "Recipe Details",
    description: "Generated by create next app",
};


async function DetailsRecipe(context: GetServerSidePropsContext) {
    let recipe: RecipeType | null = null;
    let error: string | null = null;


    try {
        recipe = await getRecipe(context);
    } catch (e) {
        error = e instanceof Error ? e.message : String(e);
    }

    if (!recipe) {
        // console.log(recipe);
    }

    const tabs = ['Ingredients', 'Tools'];
    const panels = recipe;

    return (
        <>
            {recipe && (
                <div className='flex flex-col justify-center gap-2 mb-5'>

                    <h1 className='text-5xl text-center'>{recipe.title}</h1>

                    <section className='mx-auto'>
                        <Image
                            src={recipe.imageUrl}
                            height={300}
                            width={300}
                            alt={recipe.title}
                            className='rounded-md'
                        />
                    </section>

                    <section>
                        <span className='mb-3 text-2xl flex flex-row items-center gap-3'>
                            <NotepadText />
                            <h2>Instruction</h2>
                        </span>
                        <div className='bg-slate-700 rounded-sm px-5 py-2'>
                            <p>{recipe.instructions}</p>
                        </div>
                    </section>

                    <section className='my-3'>
                        <span className='mb-3 text-2xl flex flex-row items-center gap-3'>
                            <List />
                            <h2>Steps</h2>
                        </span>
                        <Slider steps={recipe.steps} />
                    </section>

                    <section>   
                        <Tabs tabs={tabs} panels={recipe} />
                    </section>
                </div>
            )}
        </>
    )
}

export default DetailsRecipe